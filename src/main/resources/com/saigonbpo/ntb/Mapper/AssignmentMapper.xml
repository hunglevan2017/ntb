<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN'
  'http://mybatis.org/dtd/mybatis-3-mapper.dtd'>

<mapper namespace='com.saigonbpo.ntb.Mapper.AssignmentMapper'>

	
	<select id="getShips" resultType="map">
		SELECT * FROM ${jdbc.schema}.sea_tau where isActive=1
	</select>
	
	<select id="loadCrewOnShip" resultType="map">
		call ${jdbc.schema}.SP_DieuDong_Search (413,#{tauid},null,null,null,null,null,true,1,100000)
	</select>
	
	<select id="loadTVDuTru" resultType="map">
		call ${jdbc.schema}.SP_Tim_Kiem_TV_Du_Tru (413,null,null,null,null,null,#{tauid},1,null)
	</select>
	
	<select id="getChucDanh" resultType="map" parameterType="string">
		select *
				from ${jdbc.schema}.sea_thongtinchucdanh
				where thuyenvienId=#{id}
				order by denngay
				limit 0,1;
	</select>
	
	<update id = "updateOldDieuDong" parameterType = "map">
		UPDATE  ${jdbc.schema}.sea_thongtindieudong  set
			denngay=DATE_SUB( str_to_date(  #{tungay}  , '%d/%m/%Y' ) , INTERVAL 1 DAY), 
			ghichuon= #{ghichuon}
			where id = (
					SELECT max(id) 
					FROM (select * from ${jdbc.schema}.sea_thongtindieudong) t
					 WHERE t.thuyenvienId=#{thuyenvienid} 
				   )
	 </update>
	 
	 <insert id="insertNewDieuDong" parameterType = "map" >
 			INSERT INTO ${jdbc.schema}.sea_thongtindieudong
 			(tauID, thuyenvienId, tungay, ghichuon) VALUES (#{tauID},#{thuyenvienId},#{tungay},#{ghichuon})
	</insert>
	
	<update id = "updateTinhTrangDieuDong" parameterType = "map">
		UPDATE  ${jdbc.schema}.sea_thongtinthuyenvien set
			tinhtrangdieudong=1
		where id = #{thuyenvienid}
	 </update>
	
	
		

</mapper>

